<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>실시간 접수 상황 확인 페이지</title>

  {% include 'center/layout/head.html' %}


  <style>
    /* content*/
    .content {
      width: 83%;
      height: 80%;
      float: left;
      color: black;
      padding-top: 17px;
      padding-right: 30px;
      font-size: 18px;
      font-family: 'Noto Sans KR', sans-serif;
    }

    .table {
      border: 1.6px solid black;
      text-align: center;
    }

    /* footer */
    .basefooter {
      width: 100%;
      height: 5%;
    }
  </style>


  <script>
    $(function () {

      let orderKindText = "";
      let orderButtonColor = "";

      function getRealtimeOrderList() {
        $.ajax({
          url: "http://localhost:8000/center/realtimeorder/get/",
          method: "GET",
        }).done(function (response) {
          console.log(response);

          const tr_array = response.map((getrealtimeorder, index) => {

            const buttonId = `btn-detail-ask-${index}`;

            // order_kind에 따라 다른 값을 할당
            if (getrealtimeorder.order_kind === "order") {
              orderKindText = "주문";
              orderButtonColor = "danger";
            } else if (getrealtimeorder.order_kind === "change") {
              orderKindText = "변경";
              orderButtonColor = "warning";
            } else if (getrealtimeorder.order_kind === "cancel") {
              orderKindText = "취소";
              orderButtonColor = "success";
            }

            return $(
              `<tr>
              <td>${index + 1}</td>
              <td>${getrealtimeorder.phone_number}</td>
              <td>${getrealtimeorder.gear_type}</td>
              <td>${getrealtimeorder.start_address}</td>
              <td>${getrealtimeorder.end_address}</td>
              <td>${getrealtimeorder.operation_day}</td>
              <td>
                <button id="${buttonId}" class="btn btn-${orderButtonColor} btn-sm btn-detail-ask">
                  ${orderKindText}요청</button>
              </td>
              <td>
                <button class="btn btn-dark btn-sm btn-detail-confirm" data-order-id="${getrealtimeorder.is_hide}">
                  최종확인
                </button>
              </td>
            </tr>`
            );
          });

          $("#data_table > tbody").append(tr_array);
        });
      }

      getRealtimeOrderList();

    });


    // // 접수, 변경, 취소 요청 시 
    $(document).on("click", ".btn-detail-ask", function () {
      const button = $(this);
      const orderKindText = button.text();
      const changeText = orderKindText.replace("요청", "") + "완료";
      const orderId = button.data("order-id");
      const buttonClasses = button.attr("class");
      const orderButtonColor = buttonClasses.split("btn-")[1].split(" ")[0];


      const spanElement = $("<span>")
        .text(changeText)
        .attr("id", "ask_text")
        .addClass(`text-${orderButtonColor}`)
        .css("font-weight", "bold");

      button.replaceWith(spanElement);


      // $.ajax({
      //   url: '/center/realtimeorder/get/',
      //   method: 'POST',
      //   contentType: 'application/json',
      //   data: { order_type: false },
      // }).done(function (response) {
      //   console.log(data);
      // }).fail(function (xhr, status, error) {
      //   alert('실패: ' + error);
      // });



    });



  </script>


</head>


<body>
  <div class="container-fluid">
    <div class="row">
      {% include 'center/layout/base.html' %}
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 mt-3">
        <h3>실시간 접수 상황</h3>
        <div class="table-responsive">
          <table class="table table-striped table-sm" id="data_table">
            <thead>
              <tr>
                <th scope="col"></th>
                <th scope="col">전화번호</th>
                <th scope="col">기어</th>
                <th scope="col">출발지</th>
                <th scope="col">목적지</th>
                <th scope="col">등록일</th>
                <th scope="col">접수상황</th>
                <th scope="col">최종확인</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </main>
    </div>
  </div>

</body>

</html>

<!-- 접수상황 버튼 누르면 
//   1. __완료가 text로 되게 (색깔 유의)
//   2. 최종확인 버튼 활성화면서 깜박깜박거리게 
//   3. 자바스크립트 인터벌 함수 사용 (5초), 돔 핸들링-->