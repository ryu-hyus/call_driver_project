<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 정보</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        th {
            font-size: 20px;
            line-height: 80px;
        }

        #container {
            margin: 20px;
            padding: 10px;
            /* width:80%; */
        }

        .person {
            display: block;
            margin: 30px;
            color: orange;
        }

        #flex {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        a,
        p {
            color: green;
            text-decoration: none;
            font-weight: 600;
        }

        #change:hover {
            text-decoration: underline;
        }

        #head {
            margin-bottom: 30px;
            border-bottom: 1px solid #ccc;
            width: calc(100%);
        }

        #footer {
            height: 150px;
            background-color: #ffe47e;
            padding: 45px;
        }
    </style>
</head>

<body>
    <div id="container">
        <h1>내정보 관리</h1>
        <table id="head">
            <tr>
                <td style="width:10%">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor"
                        class="bi bi-person-circle person" viewBox="0 0 16 16">
                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                        <path fill-rule="evenodd"
                            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                    </svg>
                </td>
                <td style="width:90%">
                    <h2 id="customer_name"></h2>
                </td>
            </tr>
        </table>
        <div id="flex">
            <div>
                <p>회원정보</p>
            </div>
            <div>
                <a id="change" href="">
                    <p>회원정보 수정</p>
                </a>
            </div>
        </div>
        <form method="post">
            {% csrf_token %}
            <div class="form-floating mb-3">
                <input type="text" name="name" class="form-control rounded-4" id="name" placeholder="이름을 입력해주세요">
                <label for="name">이름</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" name="phone_number" class="form-control rounded-4" id="phone_number"
                    placeholder="전화번호를 입력해주세요">
                <label for="phone_number">전화번호</label>
            </div>
            <fieldset class="row mb-3">
                <legend class="col-form-label col-sm-2 pt-0">기어 선택</legend>
                <div class="col-sm-10">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="auto" value="auto">
                        <label class="form-check-label" for="auto">
                            자동
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="manual" value="manual">
                        <label class="form-check-label" for="manual">
                            수동
                        </label>
                    </div>
            </fieldset>
    </div>
    <div id="footer" class="text-center">
        <a href="" class="h5" id="logout">LogOut</a>
        <a href="" id="home">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z"/>
                <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z"/>
              </svg>
        </a>
    </div>
    <script>
        $(function () {
            $.ajaxSetup({
                headers: { "X-CSRFToken": "{{ csrf_token }}" } // 모든 AJAX 요청에 CSRF 토큰 포함
            });

            var user_id = sessionStorage.getItem('user_id');

            $.ajax({
                url: `http://127.0.0.1:8000/customer/customer_info/${user_id}/`,
                method: "GET",
                dataType: 'json',
            }).done(function (response) {
                console.log(response);
                $('#customer_name').text(response.name);
                $('#name').val(response.name);
                $('#phone_number').val(response.phone_number);

                if (response.gear_type === 'auto') {
                    $('#auto').prop('checked', true);
                } else if (response.gear_type === 'manual') {
                    $('#manual').prop('checked', true);
                }
            });

            $('#change').on('click', function (e) {
                e.preventDefault();

                const name = $('#name').val();
                const phone_number = $('#phone_number').val();
                const gear_type = $('input[type="radio"]:checked').val();
                console.log(`이름 : ${name},\n 전화번호 : ${phone_number},\n 기어 종류 : ${gear_type}`)

                $.ajax({
                    url: "http://127.0.0.1:8000/customer/mypage/update_profile/",
                    method: "POST",
                    ontentType: "application/json",
                    data: JSON.stringify({
                        "name": name,
                        "phone_number": phone_number,
                        "gear_type": gear_type
                    }),
                }).done(function (response) {
                    // 성공적으로 수정되었을 때 처리할 내용
                    alert(response.message);
                }).fail(function (xhr, status, error) {
                    // 오류 발생 시 처리할 내용
                    alert('회원정보 수정에 실패했습니다.');
                });
            });

            $('#logout').on('click', (e) => {
                e.preventDefault();
                location.href = '/customer/logout/'
            })
            $('#home').on('click', (e) => {
                e.preventDefault();
                location.href='/customer/home/'
            })
        });
    </script>
</body>

</html>